## xpaictl 使用说明

本工程默认提供的是安装部署脚本，不含离线安装的镜像包。由于离线包中xpai的扩展镜像内包含大量AI框架导致镜像提及较大不方便传输。
用户拿到本脚本后通过运行make命令可在本地构建出xpai的离线镜像包。


### 构建离线镜像包

依赖make命令，构建前请安装make

1. 配置文件 `xpai.yaml`

在构建离线镜像包之前，确认部署xpai的版本是晓石还是厂家OEM版本。如果是OEM版本，请在xpai.yaml配置文件中修改如下内容

```
productSuffix: <厂家名称>
# 例如： 云易捷版本配置
# productSuffix: qcloud
```

2. 执行构建镜像

```
make package
```

执行完成后，离线镜像会保存在 `artifacts/images`目录下，此时将本工程整体拷贝到被安装机器上开始安装



### 安装xpai

讲本工程（包含离线镜像）拷贝到目标节点

1. 配置文件 `xpai.yaml`

配置说明参考文件内说明

2. 确定被安装的集群主机

> NOTES： 根据xpai.yaml 内的ssh配置，确保集群内所有主机的ssh端口、root密码一致


##### 部署样例：

- 部署单节点(172.16.1.1)的XPAI平台

```bash
./xpaictl.sh --config xpai.yaml --masters 172.16.1.1
```

- 部署单master(172.16.1.1),3计算节点（172.16.1.2,172.16.1.3,172.16.1.4）的XPAI平台

```bash
./xpaictl.sh --config xpai.yaml --masters 172.16.1.1 --nodes 172.16.1.2,172.16.1.3,172.16.1.4
```


- 部署单3master(172.16.1.1,172.16.1.2,172.16.1.3),3计算节点（172.16.1.4,172.16.1.5,172.16.1.6）的XPAI平台

```bash
./xpaictl.sh --config xpai.yaml --masters 172.16.1.1,172.16.1.2,172.16.1.3 --nodes 172.16.1.4,172.16.1.5,172.16.1.6
```

### 激活

部署完成后会输出如下信息，此时需要拿着license信息获取授权激活

![alt text](image.png)